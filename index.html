<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> <!--320-->
    <script src="jquery-2.1.3.js"></script>
    <style type="text/css">
     *{
       margin: 0px;
       padding: 0px;
     }
     /* attempt to prevent scrolling */
      html, body {
        overflow-x: hidden;
      }
      body {
        position: relative
      }
      .vtrack{
        height: 100px;
        width: 30px;
        background: #DDD;
        position: relative;
        float: left;
      }
      .grabber{
        width: 30px;
        height: 30px;
        position: absolute;
        top: 0%;
        background: #F0F;
      }
      #container{
        border: 2px #000 solid;
        background: #FFF;
        margin-left: auto;
        margin-right: auto;
        margin-top: 0px;
        position: relative;
      }
      #settings{
        position: absolute;
        top: 10px;
        left: 50px;
      }
      #middle_section{
        float: left;
        height: 100px;
      }
    </style>
  </head>
  <!--
  Things learned
  ==============
  It's not worth using percentages on phones, as they suck when you switch
  from portrait to landscape. (I'm sure if I was working on a full-fledged site
  I wouldn't be so quick to switch). Since this is a simple one-screen application
  I'd rather just use exact pixel counts.

  I'll need the user to do the following:
  - enter the game id
  - enter full screen
  - switch to landscape
  -->
  <body>
    <main id="container">
      <section id="settings">
        <button id="btn-fullscreen">Go Fullscreen</button>
        <p id="feedback">I'm feedback</p>
      </section>
      <div id="left_lever" class="vtrack" data-css-margin-top="5%" data-css-height="90%" data-css-margin-left="2%" data-css-width="5%">
        <div class="grabber" data-css-width="5%"></div>
      </div>
      <section id="middle_section" data-css-width="86%">
        test
      </section>
      <div id="right_lever" class="vtrack" data-css-margin-top="5%" data-css-height="90%" data-css-margin-right="2%" data-css-width="5%">
        <div class="grabber" data-css-width="5%"></div>
      </div>
    </main>
    <script>
      function toggleFullScreen() {
        var doc = window.document;
        var docEl = $("#container")[0];

        var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
        var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

        if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
          requestFullScreen.call(docEl);
        }
        else {
          cancelFullScreen.call(doc);
        }
      }
      function f(msg){
        $("#feedback").html(msg);
      }

      function VerticalSlider(el){
        var that = this;
        el = $(el);
        var state = "sleep" //valid states are sleep, awake (like focused), and active (being touched)
            , grabber = el.find(".grabber")
            ;

        function awaken(){
          state = "awake";
        }

        /*
        Event for touch/mouse move (normal NOT jquery event)
        @param type String either "mouse" or "touch"
        */
        function activate(e, type){
          if(state == "awake" || state == "active"){
            var page_y = 0
                , grabber_height = grabber.height()
                , height = el.height()
                , bar_y = el.offset().top
                , max_y = height - grabber_height
                ;
            if(type == "mouse"){
              page_y = e.pageY;
            } else if (type == "touch"){
              var page_y = -1;
              //use most recent touch
              for(var i = 0; i < e.changedTouches.length; i++){
                if(e.changedTouches[i].target == el[0] || e.changedTouches[i].target == grabber[0]){
                  page_y = e.changedTouches[i].pageY;
                }
              }
              if(page_y == -1){
                return;
              }
            }
            //move move yo ass to the cursor
            var new_y = page_y - bar_y
            if(new_y < 0){
              new_y = 0;
            } else if (new_y > max_y){
              new_y = max_y;
            }
            grabber.css("top",  new_y + "px");
          }
        }

        function activateMouse(e){
          activate(e, "mouse");
        }

        function activateTouch(e){
          activate(e, "touch");
        }

        function sleep(){
            state = "sleep";
        }

        el.on("touchstart", awaken).on("mousedown", awaken);
        el[0].addEventListener("touchmove", activateTouch);
        document.body.addEventListener("mousemove", activateMouse);
        $(document.body).on("touchend", sleep).on("mouseup", sleep);
        return that;
      }

      new VerticalSlider(document.querySelector("#left_lever"));
      new VerticalSlider(document.querySelector("#right_lever"));

      $("#btn-fullscreen").on("click", toggleFullScreen);

      /* adapts to window size */
      (function(){
        //size constraints
        var max_width = 500
            , min_width = 300
            , max_height = 300
            , min_height = 150
            ;
        function fixWindow(){
          var ww = $(window).width();
          var wh = $(window).height();
          var width = ww > wh ? ww : wh;
          var height = ww > wh ? wh : ww;
          if(width > max_width) width = max_width;
          if(width < min_width) width = min_width;
          if(height > max_height) height = max_height;
          if(height < min_height) height = min_height;
          $("#container").width(width);
          $("#container").height(height);
          f(ww + "x" + wh);
          fixCSS(width, height);
        }
        function percentToNum(perc){
          return parseInt(perc.substring(0, perc.length - 1));
        }

        function fixCSS(width, height){
          /*
          @param whole float Either the width/height value of the entire screen
          */
          function fixProperty(prop, whole){
            var prefix = "data-css-";
            $("[" + prefix + prop + "]").each(function(index){
              var perc = percentToNum($(this).attr(prefix + prop));
              var fixed_value = Math.round(whole * (perc/100));
              $(this).css(prop, fixed_value + "px");
            })
          }
          fixProperty("width", width);
          fixProperty("height", height);
          fixProperty("margin-top", height);
          fixProperty("margin-bottom", height);
          fixProperty("margin-left", width);
          fixProperty("margin-right", width);
        }
        window.addEventListener("orientationchange", fixWindow, false);
        fixWindow();
      }());
    </script>
  </body>
</html>
